# æ•°å­—æƒ å†œOAç®¡ç†ç³»ç»Ÿ - åç«¯APIæ–‡æ¡£

## ç³»ç»Ÿæ¦‚è¿°

æ•°å­—æƒ å†œOAç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸ºå†œä¸šé‡‘èè´·æ¬¾å®¡æ‰¹è€Œè®¾è®¡çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

1. **ğŸ” ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†**
   - OAç”¨æˆ·ç™»å½•è®¤è¯
   - åŸºäºJWTçš„ä¼šè¯ç®¡ç†
   - è§’è‰²æƒé™æ§åˆ¶ï¼ˆç®¡ç†å‘˜/å®¡æ‰¹å‘˜ï¼‰
   - ç”¨æˆ·çŠ¶æ€ç®¡ç†

2. **ğŸ“Š å·¥ä½œå°/é¦–é¡µ**
   - ç³»ç»Ÿç»Ÿè®¡æ•°æ®å±•ç¤º
   - ä¸ªäººå¾…åŠäº‹é¡¹åˆ—è¡¨
   - å¿«æ·æ“ä½œèœå•
   - æœ€è¿‘æ´»åŠ¨è®°å½•

3. **ğŸ“‹ è´·æ¬¾å®¡æ‰¹ç®¡ç†**
   - å¾…å®¡æ‰¹ç”³è¯·åˆ—è¡¨æŸ¥è¯¢
   - ç”³è¯·è¯¦æƒ…æŸ¥çœ‹ï¼ˆå«AIåˆ†æï¼‰
   - äººå·¥å®¡æ‰¹å†³ç­–
   - ç”³è¯·å†å²è®°å½•è¿½è¸ª
   - æ–‡ä»¶é™„ä»¶ç®¡ç†

4. **âš™ï¸ ç³»ç»Ÿç®¡ç†**
   - AIå®¡æ‰¹åŠŸèƒ½å¼€å…³æ§åˆ¶
   - ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
   - é…ç½®å‚æ•°ç®¡ç†
   - å®æ—¶ç›‘æ§æ•°æ®

5. **ğŸ‘¥ ç”¨æˆ·ç®¡ç†**
   - OAç”¨æˆ·åˆ›å»º
   - ç”¨æˆ·çŠ¶æ€æ§åˆ¶
   - è§’è‰²æƒé™åˆ†é…
   - ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢

6. **ğŸ“ æ“ä½œæ—¥å¿—**
   - å…¨é¢çš„æ“ä½œå®¡è®¡
   - æ—¥å¿—æŸ¥è¯¢å’Œç­›é€‰
   - æ“ä½œè¿½æº¯
   - åˆè§„æ€§è®°å½•

### æŠ€æœ¯ç‰¹æ€§

- **æ™ºèƒ½å®¡æ‰¹æµç¨‹**ï¼šé›†æˆAIé£é™©è¯„ä¼°å’Œäººå·¥å®¡æ ¸çš„æ··åˆå®¡æ‰¹æœºåˆ¶
- **æƒé™å®‰å…¨æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„ç²¾ç»†åŒ–æƒé™ç®¡ç†
- **å®æ—¶æ•°æ®ç»Ÿè®¡**ï¼šåŠ¨æ€çš„ç³»ç»ŸæŒ‡æ ‡å’Œä¸šåŠ¡æ•°æ®å±•ç¤º
- **æ“ä½œå®¡è®¡è¿½è¸ª**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•
- **é«˜æ€§èƒ½è®¾è®¡**ï¼šæ”¯æŒé«˜å¹¶å‘è®¿é—®å’Œå¤§æ•°æ®é‡å¤„ç†

### é»˜è®¤è´¦å·

**ç³»ç»Ÿç®¡ç†å‘˜**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- æƒé™ï¼šå…¨éƒ¨ç®¡ç†åŠŸèƒ½

**å®¡æ‰¹å‘˜**
- ç”¨æˆ·åï¼š`reviewer`
- å¯†ç ï¼š`reviewer123`
- æƒé™ï¼šå®¡æ‰¹ç›¸å…³åŠŸèƒ½

## APIæ¥å£æ–‡æ¡£

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†"æ•°å­—æƒ å†œAPPåŠOAåå°ç®¡ç†ç³»ç»Ÿ"åç«¯æœåŠ¡çš„æ‰€æœ‰APIæ¥å£ã€‚

**æœåŠ¡ä¿¡æ¯:**
- **æœåŠ¡åç§°**: digital-agriculture-backend
- **ç‰ˆæœ¬**: v1.0.0
- **Base URL**: `http://localhost:8080/api/v1`
- **ç¯å¢ƒ**: development

**é€šç”¨çº¦å®š:**
- **è®¤è¯**: éœ€è¦Tokenè®¤è¯çš„æ¥å£åœ¨HTTP Headerä¸­ä¼ é€’ `Authorization: Bearer <token>`
- **è¯·æ±‚æ ¼å¼**: JSON (`Content-Type: application/json`)
- **å“åº”æ ¼å¼**: JSON
- **æˆåŠŸå“åº”**: HTTPçŠ¶æ€ç  `200 OK` æˆ– `201 Created`
- **é”™è¯¯å“åº”**: HTTPçŠ¶æ€ç  `4xx` (å®¢æˆ·ç«¯é”™è¯¯) æˆ– `5xx` (æœåŠ¡å™¨é”™è¯¯)

**å“åº”æ ¼å¼:**
```json
{
  "code": 0,           // 0è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–è¡¨ç¤ºé”™è¯¯ç 
  "message": "Success", // å“åº”æ¶ˆæ¯
  "data": { ... }      // ä¸šåŠ¡æ•°æ®
}
```

**åˆ†é¡µå“åº”æ ¼å¼:**
```json
{
  "code": 0,
  "message": "Success",
  "data": [...],       // æ•°æ®åˆ—è¡¨
  "total": 100         // æ€»æ•°é‡
}
```

## 2. å¥åº·æ£€æŸ¥æ¥å£

### 2.1 å¥åº·æ£€æŸ¥

- **URL**: `/health`
- **Method**: `GET`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "status": "ok",
    "service": "digital-agriculture-backend",
    "version": "1.0.0"
  }
}
```

## 3. ç”¨æˆ·æœåŠ¡ (UserService)

### 3.1 ç”¨æˆ·æ³¨å†Œ

- **URL**: `/api/v1/users/register`
- **Method**: `POST`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Request Body**:
```json
{
  "phone": "13800138000",
  "password": "your_password"
}
```
- **Response (201 Created)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123"
  }
}
```

### 3.2 ç”¨æˆ·ç™»å½•

- **URL**: `/api/v1/users/login`
- **Method**: `POST`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Request Body**:
```json
{
  "phone": "13800138000",
  "password": "your_password"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123",
    "token": "jwt_auth_token_string",
    "expires_in": 7200,
    "user_type": "user"
  }
}
```

### 3.3 è·å–ç”¨æˆ·ä¿¡æ¯

- **URL**: `/api/v1/users/me`
- **Method**: `GET`
- **è®¤è¯**: Required (Bearer Token)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123",
    "phone": "138****8000",
    "nickname": "å†œæˆ·å°å¼ ",
    "avatar_url": "https://example.com/avatar.jpg",
    "real_name": "å¼ ä¸‰",
    "id_card_number": "310***",
    "address": "XXçœXXå¸‚XXæ‘"
  }
}
```

### 3.4 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

- **URL**: `/api/v1/users/me`
- **Method**: `PUT`
- **è®¤è¯**: Required (Bearer Token)
- **Request Body**:
```json
{
  "nickname": "å†œæˆ·å¤§å¼ ",
  "avatar_url": "https://example.com/new_avatar.jpg",
  "real_name": "å¼ ä¸‰",
  "address": "XXçœXXå¸‚XXæ‘"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": null
}
```

## 4. è´·æ¬¾æœåŠ¡ (LoanService)

### 4.1 è·å–è´·æ¬¾äº§å“åˆ—è¡¨

- **URL**: `/api/v1/loans/products`
- **Method**: `GET`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Query Parameters**:
  - `category` (string, optional): äº§å“åˆ†ç±»
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": [
    {
      "product_id": "loan_prod_001",
      "name": "æ˜¥è€•åŠ©åŠ›è´·",
      "description": "ä¸“ä¸ºæ˜¥è€•ç”Ÿäº§è®¾è®¡ï¼Œåˆ©ç‡ä¼˜æƒ ï¼Œå¿«é€Ÿå®¡æ‰¹",
      "category": "ç§æ¤è´·",
      "min_amount": 5000,
      "max_amount": 50000,
      "min_term_months": 6,
      "max_term_months": 24,
      "interest_rate_yearly": "4.5% - 6.0%",
      "status": 0
    },
    {
      "product_id": "loan_prod_002",
      "name": "å†œæœºè´­ç½®è´·",
      "description": "æ”¯æŒå†œæˆ·è´­ä¹°å†œä¸šæœºæ¢°ï¼ŒåŠ©åŠ›å†œä¸šç°ä»£åŒ–",
      "category": "è®¾å¤‡è´·",
      "min_amount": 10000,
      "max_amount": 200000,
      "min_term_months": 12,
      "max_term_months": 60,
      "interest_rate_yearly": "5.0% - 7.0%",
      "status": 0
    }
  ]
}
```

### 4.2 è·å–è´·æ¬¾äº§å“è¯¦æƒ…

- **URL**: `/api/v1/loans/products/{product_id}`
- **Method**: `GET`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "product_id": "loan_prod_001",
    "name": "æ˜¥è€•åŠ©åŠ›è´·",
    "description": "ä¸“ä¸ºæ˜¥è€•ç”Ÿäº§è®¾è®¡ï¼Œåˆ©ç‡ä¼˜æƒ ï¼Œå¿«é€Ÿå®¡æ‰¹",
    "category": "ç§æ¤è´·",
    "min_amount": 5000,
    "max_amount": 50000,
    "min_term_months": 6,
    "max_term_months": 24,
    "interest_rate_yearly": "4.5% - 6.0%",
    "repayment_methods": ["ç­‰é¢æœ¬æ¯", "å…ˆæ¯åæœ¬"],
    "application_conditions": "1. å¹´æ»¡18å‘¨å²çš„å†œæˆ·ï¼›2. æœ‰ç¨³å®šçš„å†œä¸šæ”¶å…¥ï¼›3. ä¿¡ç”¨è®°å½•è‰¯å¥½",
    "required_documents": [
      {"type": "ID_CARD", "desc": "ç”³è¯·äººèº«ä»½è¯"},
      {"type": "LAND_CONTRACT", "desc": "åœŸåœ°æ‰¿åŒ…åˆåŒ"}
    ],
    "status": 0
  }
}
```

### 4.3 æäº¤è´·æ¬¾ç”³è¯·

- **URL**: `/api/v1/loans/applications`
- **Method**: `POST`
- **è®¤è¯**: Required (Bearer Token)
- **Request Body**:
```json
{
  "product_id": "loan_prod_001",
  "amount": 30000,
  "term_months": 12,
  "purpose": "è´­ä¹°åŒ–è‚¥å’Œç§å­",
  "applicant_info": {
    "real_name": "å¼ ä¸‰",
    "id_card_number": "310...",
    "address": "XXçœXXå¸‚XXæ‘"
  },
  "uploaded_documents": [
    {"doc_type": "id_card_front", "file_id": "file_uuid_001"},
    {"doc_type": "land_contract", "file_id": "file_uuid_002"}
  ]
}
```
- **Response (201 Created)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "loan_app_uuid_789"
  }
}
```

### 4.4 è·å–è´·æ¬¾ç”³è¯·è¯¦æƒ…

- **URL**: `/api/v1/loans/applications/{application_id}`
- **Method**: `GET`
- **è®¤è¯**: Required (Bearer Token)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "loan_app_uuid_789",
    "product_id": "loan_prod_001",
    "user_id": "user_uuid_123",
    "amount": 30000,
    "term_months": 12,
    "purpose": "è´­ä¹°åŒ–è‚¥å’Œç§å­",
    "status": "AI_REVIEWING",
    "submitted_at": "2024-03-10T10:00:00Z",
    "updated_at": "2024-03-10T11:30:00Z",
    "approved_amount": null,
    "remarks": "AIç³»ç»Ÿæ­£åœ¨åˆ†ææ‚¨çš„ç”³è¯·ä¿¡æ¯",
    "history": [
      {"status": "SUBMITTED", "timestamp": "2024-03-10T10:00:00Z", "operator": "ç”¨æˆ·"},
      {"status": "AI_REVIEWING", "timestamp": "2024-03-10T10:05:00Z", "operator": "ç³»ç»Ÿ"}
    ]
  }
}
```

### 4.5 è·å–æˆ‘çš„è´·æ¬¾ç”³è¯·åˆ—è¡¨

- **URL**: `/api/v1/loans/applications/my`
- **Method**: `GET`
- **è®¤è¯**: Required (Bearer Token)
- **Query Parameters**:
  - `status` (string, optional): æŒ‰çŠ¶æ€ç­›é€‰
  - `page` (int, optional, default: 1)
  - `limit` (int, optional, default: 10)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": [
    {
      "application_id": "loan_app_uuid_789",
      "product_name": "æ˜¥è€•åŠ©åŠ›è´·",
      "amount": 30000,
      "status": "AI_REVIEWING",
      "submitted_at": "2024-03-10T10:00:00Z"
    }
  ],
  "total": 1
}
```

## 5. æ–‡ä»¶æœåŠ¡ (FileService)

### 5.1 æ–‡ä»¶ä¸Šä¼ 

- **URL**: `/api/v1/files/upload`
- **Method**: `POST`
- **è®¤è¯**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Form Data**:
  - `file`: (file) ä¸Šä¼ çš„æ–‡ä»¶
  - `purpose`: (string, optional) æ–‡ä»¶ç”¨é€”ï¼Œå¦‚ "loan_document", "machinery_image"
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "file_id": "file_uuid_xyz",
    "file_url": "https://example.com/files/file_uuid_xyz.jpg",
    "file_name": "èº«ä»½è¯æ­£é¢.jpg",
    "file_size": 102400
  }
}
```

## 6. OAåå°ç®¡ç†æœåŠ¡ (AdminService)

### 6.1 OAç”¨æˆ·ç™»å½•

- **URL**: `/api/v1/admin/login`
- **Method**: `POST`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Request Body**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "admin_user_id": "oa_admin001",
    "username": "admin",
    "role": "ADMIN",
    "token": "admin_jwt_auth_token",
    "expires_in": 3600
  }
}
```

### 6.2 è·å–å¾…å®¡æ‰¹è´·æ¬¾ç”³è¯·åˆ—è¡¨

- **URL**: `/api/v1/admin/loans/applications/pending`
- **Method**: `GET`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Query Parameters**:
  - `status_filter` (string, optional)
  - `applicant_name` (string, optional)
  - `application_id` (string, optional)
  - `page` (int, optional, default: 1)
  - `limit` (int, optional, default: 10)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": []
}
```

### 6.3 è·å–è´·æ¬¾ç”³è¯·è¯¦æƒ… (ç®¡ç†å‘˜è§†è§’)

- **URL**: `/api/v1/admin/loans/applications/{application_id}`
- **Method**: `GET`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "application_id"
  }
}
```

### 6.4 æäº¤å®¡æ‰¹å†³ç­–

- **URL**: `/api/v1/admin/loans/applications/{application_id}/review`
- **Method**: `POST`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Request Body**:
```json
{
  "decision": "approved",
  "approved_amount": 25000,
  "comments": "ç”³è¯·äººä¿¡ç”¨è‰¯å¥½ï¼Œä½†è€ƒè™‘åˆ°å½“å‰è´Ÿå€ºï¼Œç•¥å¾®è°ƒæ•´æ‰¹å‡†é‡‘é¢ã€‚",
  "required_info_details": null
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "å®¡æ‰¹å†³ç­–æäº¤æˆåŠŸ",
  "data": null
}
```

### 6.5 æ§åˆ¶AIå®¡æ‰¹æµç¨‹å¼€å…³

- **URL**: `/api/v1/admin/system/ai-approval/toggle`
- **Method**: `POST`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Request Body**:
```json
{
  "enabled": true
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "AIå®¡æ‰¹æµç¨‹çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": null
}
```

## 7. é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|--------|------------|------|
| 0      | 200/201    | æˆåŠŸ |
| 1001   | 400        | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 1002   | 401        | æœªæˆæƒ |
| 1003   | 403        | ç¦æ­¢è®¿é—® |
| 1004   | 404        | èµ„æºä¸å­˜åœ¨ |
| 1005   | 429        | è¯·æ±‚é¢‘ç‡è¶…é™ |
| 5000   | 500        | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## 8. æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰æ—¥æœŸæ—¶é—´æ ¼å¼éµå¾ª ISO 8601 æ ‡å‡† (YYYY-MM-DDTHH:MM:SSZ)
2. æ‰€æœ‰é‡‘é¢å­—æ®µä»¥åˆ†ä¸ºå•ä½çš„æ•´æ•°è¡¨ç¤º
3. æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ä¸º 10MB
4. æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼šjpg, jpeg, png, pdf, doc, docx
5. JWT Token æœ‰æ•ˆæœŸä¸º 24 å°æ—¶
6. API è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼šæ¯åˆ†é’Ÿ 100 æ¬¡ 