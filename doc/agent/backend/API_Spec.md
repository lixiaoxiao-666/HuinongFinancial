# æ•°å­—æƒ å†œOAç®¡ç†ç³»ç»Ÿ - åç«¯APIæ–‡æ¡£

## ç³»ç»Ÿæ¦‚è¿°

æ•°å­—æƒ å†œOAç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸ºå†œä¸šé‡‘èè´·æ¬¾å®¡æ‰¹è€Œè®¾è®¡çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

1. **ğŸ” ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†**
   - OAç”¨æˆ·ç™»å½•è®¤è¯
   - åŸºäºJWTçš„ä¼šè¯ç®¡ç†
   - è§’è‰²æƒé™æ§åˆ¶ï¼ˆç®¡ç†å‘˜/å®¡æ‰¹å‘˜ï¼‰
   - ç”¨æˆ·çŠ¶æ€ç®¡ç†

2. **ğŸ“Š å·¥ä½œå°/é¦–é¡µ**
   - ç³»ç»Ÿç»Ÿè®¡æ•°æ®å±•ç¤º
   - ä¸ªäººå¾…åŠäº‹é¡¹åˆ—è¡¨
   - å¿«æ·æ“ä½œèœå•
   - æœ€è¿‘æ´»åŠ¨è®°å½•

3. **ğŸ“‹ è´·æ¬¾å®¡æ‰¹ç®¡ç†**
   - å¾…å®¡æ‰¹ç”³è¯·åˆ—è¡¨æŸ¥è¯¢
   - ç”³è¯·è¯¦æƒ…æŸ¥çœ‹ï¼ˆå«AIåˆ†æï¼‰
   - äººå·¥å®¡æ‰¹å†³ç­–
   - ç”³è¯·å†å²è®°å½•è¿½è¸ª
   - æ–‡ä»¶é™„ä»¶ç®¡ç†

4. **âš™ï¸ ç³»ç»Ÿç®¡ç†**
   - AIå®¡æ‰¹åŠŸèƒ½å¼€å…³æ§åˆ¶
   - ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
   - é…ç½®å‚æ•°ç®¡ç†
   - å®æ—¶ç›‘æ§æ•°æ®

5. **ğŸ‘¥ ç”¨æˆ·ç®¡ç†**
   - OAç”¨æˆ·åˆ›å»º
   - ç”¨æˆ·çŠ¶æ€æ§åˆ¶
   - è§’è‰²æƒé™åˆ†é…
   - ç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢

6. **ğŸ“ æ“ä½œæ—¥å¿—**
   - å…¨é¢çš„æ“ä½œå®¡è®¡
   - æ—¥å¿—æŸ¥è¯¢å’Œç­›é€‰
   - æ“ä½œè¿½æº¯
   - åˆè§„æ€§è®°å½•

### æŠ€æœ¯ç‰¹æ€§

- **æ™ºèƒ½å®¡æ‰¹æµç¨‹**ï¼šé›†æˆAIé£é™©è¯„ä¼°å’Œäººå·¥å®¡æ ¸çš„æ··åˆå®¡æ‰¹æœºåˆ¶
- **æƒé™å®‰å…¨æ§åˆ¶**ï¼šåŸºäºè§’è‰²çš„ç²¾ç»†åŒ–æƒé™ç®¡ç†
- **å®æ—¶æ•°æ®ç»Ÿè®¡**ï¼šåŠ¨æ€çš„ç³»ç»ŸæŒ‡æ ‡å’Œä¸šåŠ¡æ•°æ®å±•ç¤º
- **æ“ä½œå®¡è®¡è¿½è¸ª**ï¼šå®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•
- **é«˜æ€§èƒ½è®¾è®¡**ï¼šæ”¯æŒé«˜å¹¶å‘è®¿é—®å’Œå¤§æ•°æ®é‡å¤„ç†

### é»˜è®¤è´¦å·

**ç³»ç»Ÿç®¡ç†å‘˜**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- æƒé™ï¼šå…¨éƒ¨ç®¡ç†åŠŸèƒ½

**å®¡æ‰¹å‘˜**
- ç”¨æˆ·åï¼š`reviewer`
- å¯†ç ï¼š`reviewer123`
- æƒé™ï¼šå®¡æ‰¹ç›¸å…³åŠŸèƒ½

## APIæ¥å£æ–‡æ¡£

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†"æ•°å­—æƒ å†œAPPåŠOAåå°ç®¡ç†ç³»ç»Ÿ"åç«¯æœåŠ¡çš„æ‰€æœ‰APIæ¥å£ã€‚

**æœåŠ¡ä¿¡æ¯:**
- **æœåŠ¡åç§°**: digital-agriculture-backend
- **ç‰ˆæœ¬**: v1.0.0
- **Base URL**: `http://localhost:8080/api/v1`
- **ç¯å¢ƒ**: development

**é€šç”¨çº¦å®š:**
- **è®¤è¯**: éœ€è¦Tokenè®¤è¯çš„æ¥å£åœ¨HTTP Headerä¸­ä¼ é€’ `Authorization: Bearer <token>`
- **è¯·æ±‚æ ¼å¼**: JSON (`Content-Type: application/json`)
- **å“åº”æ ¼å¼**: JSON
- **æˆåŠŸå“åº”**: HTTPçŠ¶æ€ç  `200 OK` æˆ– `201 Created`
- **é”™è¯¯å“åº”**: HTTPçŠ¶æ€ç  `4xx` (å®¢æˆ·ç«¯é”™è¯¯) æˆ– `5xx` (æœåŠ¡å™¨é”™è¯¯)

**å“åº”æ ¼å¼:**
```json
{
  "code": 0,           // 0è¡¨ç¤ºæˆåŠŸï¼Œå…¶ä»–è¡¨ç¤ºé”™è¯¯ç 
  "message": "Success", // å“åº”æ¶ˆæ¯
  "data": { ... }      // ä¸šåŠ¡æ•°æ®
}
```

**åˆ†é¡µå“åº”æ ¼å¼:**
```json
{
  "code": 0,
  "message": "Success",
  "data": [...],       // æ•°æ®åˆ—è¡¨
  "total": 100         // æ€»æ•°é‡
}
```

## 2. å¥åº·æ£€æŸ¥æ¥å£

### 2.1 å¥åº·æ£€æŸ¥

- **URL**: `/health`
- **Method**: `GET`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "status": "ok",
    "service": "digital-agriculture-backend",
    "version": "1.0.0"
  }
}
```

## 3. ç”¨æˆ·æœåŠ¡ (UserService)

### 3.1 ç”¨æˆ·æ³¨å†Œ

- **URL**: `/api/v1/users/register`
- **Method**: `POST`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Request Body**:
```json
{
  "phone": "13800138000",
  "password": "your_password"
}
```
- **Response (201 Created)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123"
  }
}
```

### 3.2 ç”¨æˆ·ç™»å½•

- **URL**: `/api/v1/users/login`
- **Method**: `POST`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Request Body**:
```json
{
  "phone": "13800138000",
  "password": "your_password"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123",
    "token": "jwt_auth_token_string",
    "expires_in": 7200,
    "user_type": "user"
  }
}
```

### 3.3 è·å–ç”¨æˆ·ä¿¡æ¯

- **URL**: `/api/v1/users/me`
- **Method**: `GET`
- **è®¤è¯**: Required (Bearer Token)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123",
    "phone": "138****8000",
    "nickname": "å†œæˆ·å°å¼ ",
    "avatar_url": "https://example.com/avatar.jpg",
    "real_name": "å¼ ä¸‰",
    "id_card_number": "310***",
    "address": "XXçœXXå¸‚XXæ‘"
  }
}
```

### 3.4 æ›´æ–°ç”¨æˆ·ä¿¡æ¯

- **URL**: `/api/v1/users/me`
- **Method**: `PUT`
- **è®¤è¯**: Required (Bearer Token)
- **Request Body**:
```json
{
  "nickname": "å†œæˆ·å¤§å¼ ",
  "avatar_url": "https://example.com/new_avatar.jpg",
  "real_name": "å¼ ä¸‰",
  "address": "XXçœXXå¸‚XXæ‘"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ",
  "data": null
}
```

## 4. è´·æ¬¾æœåŠ¡ (LoanService)

### 4.1 è·å–è´·æ¬¾äº§å“åˆ—è¡¨

- **URL**: `/api/v1/loans/products`
- **Method**: `GET`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Query Parameters**:
  - `category` (string, optional): äº§å“åˆ†ç±»
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": [
    {
      "product_id": "loan_prod_001",
      "name": "æ˜¥è€•åŠ©åŠ›è´·",
      "description": "ä¸“ä¸ºæ˜¥è€•ç”Ÿäº§è®¾è®¡ï¼Œåˆ©ç‡ä¼˜æƒ ï¼Œå¿«é€Ÿå®¡æ‰¹",
      "category": "ç§æ¤è´·",
      "min_amount": 5000,
      "max_amount": 50000,
      "min_term_months": 6,
      "max_term_months": 24,
      "interest_rate_yearly": "4.5% - 6.0%",
      "status": 0
    },
    {
      "product_id": "loan_prod_002",
      "name": "å†œæœºè´­ç½®è´·",
      "description": "æ”¯æŒå†œæˆ·è´­ä¹°å†œä¸šæœºæ¢°ï¼ŒåŠ©åŠ›å†œä¸šç°ä»£åŒ–",
      "category": "è®¾å¤‡è´·",
      "min_amount": 10000,
      "max_amount": 200000,
      "min_term_months": 12,
      "max_term_months": 60,
      "interest_rate_yearly": "5.0% - 7.0%",
      "status": 0
    }
  ]
}
```

### 4.2 è·å–è´·æ¬¾äº§å“è¯¦æƒ…

- **URL**: `/api/v1/loans/products/{product_id}`
- **Method**: `GET`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "product_id": "loan_prod_001",
    "name": "æ˜¥è€•åŠ©åŠ›è´·",
    "description": "ä¸“ä¸ºæ˜¥è€•ç”Ÿäº§è®¾è®¡ï¼Œåˆ©ç‡ä¼˜æƒ ï¼Œå¿«é€Ÿå®¡æ‰¹",
    "category": "ç§æ¤è´·",
    "min_amount": 5000,
    "max_amount": 50000,
    "min_term_months": 6,
    "max_term_months": 24,
    "interest_rate_yearly": "4.5% - 6.0%",
    "repayment_methods": ["ç­‰é¢æœ¬æ¯", "å…ˆæ¯åæœ¬"],
    "application_conditions": "1. å¹´æ»¡18å‘¨å²çš„å†œæˆ·ï¼›2. æœ‰ç¨³å®šçš„å†œä¸šæ”¶å…¥ï¼›3. ä¿¡ç”¨è®°å½•è‰¯å¥½",
    "required_documents": [
      {"type": "ID_CARD", "desc": "ç”³è¯·äººèº«ä»½è¯"},
      {"type": "LAND_CONTRACT", "desc": "åœŸåœ°æ‰¿åŒ…åˆåŒ"}
    ],
    "status": 0
  }
}
```

### 4.3 æäº¤è´·æ¬¾ç”³è¯·

- **URL**: `/api/v1/loans/applications`
- **Method**: `POST`
- **è®¤è¯**: Required (Bearer Token)
- **Request Body**:
```json
{
  "product_id": "loan_prod_001",
  "amount": 30000,
  "term_months": 12,
  "purpose": "è´­ä¹°åŒ–è‚¥å’Œç§å­",
  "applicant_info": {
    "real_name": "å¼ ä¸‰",
    "id_card_number": "310...",
    "address": "XXçœXXå¸‚XXæ‘"
  },
  "uploaded_documents": [
    {"doc_type": "id_card_front", "file_id": "file_uuid_001"},
    {"doc_type": "land_contract", "file_id": "file_uuid_002"}
  ]
}
```
- **Response (201 Created)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "loan_app_uuid_789"
  }
}
```

### 4.4 è·å–è´·æ¬¾ç”³è¯·è¯¦æƒ…

- **URL**: `/api/v1/loans/applications/{application_id}`
- **Method**: `GET`
- **è®¤è¯**: Required (Bearer Token)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "loan_app_uuid_789",
    "product_id": "loan_prod_001",
    "user_id": "user_uuid_123",
    "amount": 30000,
    "term_months": 12,
    "purpose": "è´­ä¹°åŒ–è‚¥å’Œç§å­",
    "status": "AI_REVIEWING",
    "submitted_at": "2024-03-10T10:00:00Z",
    "updated_at": "2024-03-10T11:30:00Z",
    "approved_amount": null,
    "remarks": "AIç³»ç»Ÿæ­£åœ¨åˆ†ææ‚¨çš„ç”³è¯·ä¿¡æ¯",
    "history": [
      {"status": "SUBMITTED", "timestamp": "2024-03-10T10:00:00Z", "operator": "ç”¨æˆ·"},
      {"status": "AI_REVIEWING", "timestamp": "2024-03-10T10:05:00Z", "operator": "ç³»ç»Ÿ"}
    ]
  }
}
```

### 4.5 è·å–æˆ‘çš„è´·æ¬¾ç”³è¯·åˆ—è¡¨

- **URL**: `/api/v1/loans/applications/my`
- **Method**: `GET`
- **è®¤è¯**: Required (Bearer Token)
- **Query Parameters**:
  - `status` (string, optional): æŒ‰çŠ¶æ€ç­›é€‰
  - `page` (int, optional, default: 1)
  - `limit` (int, optional, default: 10)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": [
    {
      "application_id": "loan_app_uuid_789",
      "product_name": "æ˜¥è€•åŠ©åŠ›è´·",
      "amount": 30000,
      "status": "AI_REVIEWING",
      "submitted_at": "2024-03-10T10:00:00Z"
    }
  ],
  "total": 1
}
```

## 5. æ–‡ä»¶æœåŠ¡ (FileService)

### 5.1 æ–‡ä»¶ä¸Šä¼ 

- **URL**: `/api/v1/files/upload`
- **Method**: `POST`
- **è®¤è¯**: Required (Bearer Token)
- **Content-Type**: `multipart/form-data`
- **Form Data**:
  - `file`: (file) ä¸Šä¼ çš„æ–‡ä»¶
  - `purpose`: (string, optional) æ–‡ä»¶ç”¨é€”ï¼Œå¦‚ "loan_document", "machinery_image"
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "file_id": "file_uuid_xyz",
    "file_url": "https://example.com/files/file_uuid_xyz.jpg",
    "file_name": "èº«ä»½è¯æ­£é¢.jpg",
    "file_size": 102400
  }
}
```

## 6. OAåå°ç®¡ç†æœåŠ¡ (AdminService)

### 6.1 OAç”¨æˆ·ç™»å½•

- **URL**: `/api/v1/admin/login`
- **Method**: `POST`
- **è®¤è¯**: æ— éœ€è®¤è¯
- **Request Body**:
```json
{
  "username": "admin",
  "password": "admin123"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "admin_user_id": "oa_admin001",
    "username": "admin",
    "role": "ADMIN",
    "token": "admin_jwt_auth_token",
    "expires_in": 3600
  }
}
```

### 6.2 è·å–å¾…å®¡æ‰¹è´·æ¬¾ç”³è¯·åˆ—è¡¨

- **URL**: `/api/v1/admin/loans/applications/pending`
- **Method**: `GET`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Query Parameters**:
  - `status_filter` (string, optional)
  - `applicant_name` (string, optional)
  - `application_id` (string, optional)
  - `page` (int, optional, default: 1)
  - `limit` (int, optional, default: 10)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": []
}
```

### 6.3 è·å–è´·æ¬¾ç”³è¯·è¯¦æƒ… (ç®¡ç†å‘˜è§†è§’)

- **URL**: `/api/v1/admin/loans/applications/{application_id}`
- **Method**: `GET`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "application_id"
  }
}
```

### 6.4 æäº¤å®¡æ‰¹å†³ç­–

- **URL**: `/api/v1/admin/loans/applications/{application_id}/review`
- **Method**: `POST`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Request Body**:
```json
{
  "decision": "approved",
  "approved_amount": 25000,
  "comments": "ç”³è¯·äººä¿¡ç”¨è‰¯å¥½ï¼Œä½†è€ƒè™‘åˆ°å½“å‰è´Ÿå€ºï¼Œç•¥å¾®è°ƒæ•´æ‰¹å‡†é‡‘é¢ã€‚",
  "required_info_details": null
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "å®¡æ‰¹å†³ç­–æäº¤æˆåŠŸ",
  "data": null
}
```

### 6.5 æ§åˆ¶AIå®¡æ‰¹æµç¨‹å¼€å…³

- **URL**: `/api/v1/admin/system/ai-approval/toggle`
- **Method**: `POST`
- **è®¤è¯**: Required (Admin Bearer Token)
- **Request Body**:
```json
{
  "enabled": true
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "AIå®¡æ‰¹æµç¨‹çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": null
}
```

## 7. é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|--------|------------|------|
| 0      | 200/201    | æˆåŠŸ |
| 1001   | 400        | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 1002   | 401        | æœªæˆæƒ |
| 1003   | 403        | ç¦æ­¢è®¿é—® |
| 1004   | 404        | èµ„æºä¸å­˜åœ¨ |
| 1005   | 429        | è¯·æ±‚é¢‘ç‡è¶…é™ |
| 5000   | 500        | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## 8. æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰æ—¥æœŸæ—¶é—´æ ¼å¼éµå¾ª ISO 8601 æ ‡å‡† (YYYY-MM-DDTHH:MM:SSZ)
2. æ‰€æœ‰é‡‘é¢å­—æ®µä»¥åˆ†ä¸ºå•ä½çš„æ•´æ•°è¡¨ç¤º
3. æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ä¸º 10MB
4. æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼šjpg, jpeg, png, pdf, doc, docx
5. JWT Token æœ‰æ•ˆæœŸä¸º 24 å°æ—¶
6. API è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼šæ¯åˆ†é’Ÿ 100 æ¬¡ 

## 9. AIæ™ºèƒ½ä½“æœåŠ¡ (AIAgentService)

> **é‡è¦è¯´æ˜**: ä»¥ä¸‹æ¥å£ä¸“é—¨ä¸ºDify AIå·¥ä½œæµè®¾è®¡ï¼Œç”¨äºå®ç°æ™ºèƒ½å®¡æ‰¹åŠŸèƒ½ã€‚

### 9.1 è·å–å®¡æ‰¹ç”³è¯·ä¿¡æ¯ (ä¾›Difyå·¥ä½œæµè°ƒç”¨)

- **URL**: `/api/v1/ai-agent/applications/{application_id}/info`
- **Method**: `GET`
- **è®¤è¯**: Required (AI Agent Token)
- **ç”¨é€”**: Difyå·¥ä½œæµé€šè¿‡æ­¤æ¥å£è·å–å¾…å®¡æ‰¹ç”³è¯·çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€ç”³è¯·è¯¦æƒ…ã€ä¸Šä¼ æ–‡ä»¶ç­‰
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "application_id": "loan_app_uuid_789",
    "product_info": {
      "product_id": "loan_prod_001",
      "name": "æ˜¥è€•åŠ©åŠ›è´·",
      "category": "ç§æ¤è´·",
      "max_amount": 50000,
      "interest_rate_yearly": "4.5% - 6.0%"
    },
    "application_info": {
      "amount": 30000,
      "term_months": 12,
      "purpose": "è´­ä¹°åŒ–è‚¥å’Œç§å­",
      "submitted_at": "2024-03-10T10:00:00Z",
      "status": "SUBMITTED"
    },
    "applicant_info": {
      "user_id": "user_uuid_123",
      "real_name": "å¼ ä¸‰",
      "id_card_number": "310***********1234",
      "phone": "138****8000",
      "address": "XXçœXXå¸‚XXæ‘",
      "age": 35,
      "is_verified": true
    },
    "financial_info": {
      "annual_income": 80000,
      "existing_loans": 0,
      "credit_score": 750,
      "account_balance": 15000,
      "land_area": "10äº©",
      "farming_experience": "10å¹´"
    },
    "uploaded_documents": [
      {
        "doc_type": "id_card_front",
        "file_id": "file_uuid_001",
        "file_url": "https://example.com/files/id_front.jpg",
        "ocr_result": {
          "name": "å¼ ä¸‰",
          "id_number": "310***********1234",
          "address": "XXçœXXå¸‚XXæ‘"
        }
      },
      {
        "doc_type": "land_contract",
        "file_id": "file_uuid_002",
        "file_url": "https://example.com/files/land_contract.pdf",
        "extracted_info": {
          "land_area": "10äº©",
          "contract_period": "30å¹´",
          "location": "XXçœXXå¸‚XXæ‘"
        }
      }
    ],
    "external_data": {
      "credit_bureau_score": 750,
      "blacklist_check": false,
      "previous_loan_history": [],
      "land_ownership_verified": true
    }
  }
}
```

### 9.2 æäº¤AIå®¡æ‰¹ç»“æœ (ä¾›Difyå·¥ä½œæµè°ƒç”¨)

- **URL**: `/api/v1/ai-agent/applications/{application_id}/ai-decision`
- **Method**: `POST`
- **è®¤è¯**: Required (AI Agent Token)
- **ç”¨é€”**: Difyå·¥ä½œæµå®Œæˆåˆ†æåï¼Œé€šè¿‡æ­¤æ¥å£æäº¤AIå®¡æ‰¹å†³ç­–ç»“æœ
- **Request Body**:
```json
{
  "ai_analysis": {
    "risk_level": "LOW",
    "risk_score": 0.25,
    "confidence_score": 0.92,
    "analysis_summary": "ç”³è¯·äººä¿¡ç”¨è®°å½•è‰¯å¥½ï¼Œæœ‰ç¨³å®šå†œä¸šæ”¶å…¥ï¼ŒåœŸåœ°æ‰¿åŒ…åˆåŒæœ‰æ•ˆï¼Œç»¼åˆé£é™©è¾ƒä½ã€‚",
    "detailed_analysis": {
      "identity_verification": {
        "status": "PASSED",
        "score": 1.0,
        "details": "èº«ä»½è¯ä¿¡æ¯ä¸ç”³è¯·ä¿¡æ¯ä¸€è‡´ï¼ŒOCRè¯†åˆ«å‡†ç¡®"
      },
      "financial_assessment": {
        "status": "PASSED",
        "score": 0.85,
        "details": "å¹´æ”¶å…¥8ä¸‡å…ƒï¼Œè´Ÿå€ºç‡ä½ï¼Œè¿˜æ¬¾èƒ½åŠ›è¾ƒå¼º"
      },
      "credit_evaluation": {
        "status": "PASSED",
        "score": 0.9,
        "details": "ä¿¡ç”¨è¯„åˆ†750åˆ†ï¼Œæ— ä¸è‰¯è®°å½•"
      },
      "document_verification": {
        "status": "PASSED",
        "score": 0.95,
        "details": "æ‰€æœ‰å¿…è¦æ–‡ä»¶å·²æäº¤ä¸”æœ‰æ•ˆ"
      },
      "fraud_detection": {
        "status": "PASSED",
        "score": 0.98,
        "details": "æœªå‘ç°æ¬ºè¯ˆé£é™©"
      }
    },
    "risk_factors": [
      {
        "factor": "ç”³è¯·é‡‘é¢",
        "level": "LOW",
        "description": "ç”³è¯·é‡‘é¢30000å…ƒï¼Œåœ¨äº§å“é™é¢èŒƒå›´å†…"
      },
      {
        "factor": "è¿˜æ¬¾èƒ½åŠ›",
        "level": "LOW", 
        "description": "å¹´æ”¶å…¥8ä¸‡å…ƒï¼Œæœˆè¿˜æ¬¾å‹åŠ›è¾ƒå°"
      }
    ],
    "recommendations": [
      "å»ºè®®æ‰¹å‡†ç”³è¯·",
      "å¯æŒ‰ç”³è¯·é‡‘é¢å…¨é¢æ‰¹å‡†",
      "å»ºè®®é‡‡ç”¨ç­‰é¢æœ¬æ¯è¿˜æ¬¾æ–¹å¼"
    ]
  },
  "ai_decision": {
    "decision": "AUTO_APPROVED",
    "approved_amount": 30000,
    "approved_term_months": 12,
    "suggested_interest_rate": "5.2%",
    "conditions": [],
    "next_action": "DIRECT_APPROVAL"
  },
  "processing_info": {
    "ai_model_version": "v1.2.0",
    "processing_time_ms": 2500,
    "workflow_id": "dify_workflow_001",
    "processed_at": "2024-03-10T10:05:30Z"
  }
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "AIå®¡æ‰¹ç»“æœå·²æˆåŠŸå¤„ç†",
  "data": {
    "application_id": "loan_app_uuid_789",
    "new_status": "AI_APPROVED",
    "next_step": "AWAIT_FINAL_CONFIRMATION"
  }
}
```

### 9.3 è§¦å‘AIå®¡æ‰¹å·¥ä½œæµ

- **URL**: `/api/v1/ai-agent/applications/{application_id}/trigger-workflow`
- **Method**: `POST`
- **è®¤è¯**: Required (System Token)
- **ç”¨é€”**: å½“ç”¨æˆ·æäº¤ç”³è¯·åï¼Œç³»ç»Ÿè°ƒç”¨æ­¤æ¥å£è§¦å‘Dify AIå·¥ä½œæµ
- **Request Body**:
```json
{
  "workflow_type": "LOAN_APPROVAL",
  "priority": "NORMAL",
  "callback_url": "https://backend.example.com/api/v1/ai-agent/applications/{application_id}/ai-decision"
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "AIå®¡æ‰¹å·¥ä½œæµå·²å¯åŠ¨",
  "data": {
    "workflow_execution_id": "dify_exec_uuid_456",
    "estimated_completion_time": "2024-03-10T10:08:00Z",
    "status": "RUNNING"
  }
}
```

### 9.4 è·å–AIæ¨¡å‹é…ç½®ä¿¡æ¯ (ä¾›Difyè°ƒç”¨)

- **URL**: `/api/v1/ai-agent/config/models`
- **Method**: `GET`
- **è®¤è¯**: Required (AI Agent Token)
- **ç”¨é€”**: Difyå·¥ä½œæµè·å–å½“å‰å¯ç”¨çš„AIæ¨¡å‹é…ç½®å’Œè§„åˆ™å‚æ•°
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "active_models": [
      {
        "model_id": "risk_assessment_v2",
        "model_type": "RISK_EVALUATION",
        "version": "2.1.0",
        "status": "ACTIVE",
        "thresholds": {
          "low_risk": 0.3,
          "medium_risk": 0.7,
          "high_risk": 0.9
        }
      },
      {
        "model_id": "fraud_detection_v1",
        "model_type": "FRAUD_DETECTION",
        "version": "1.5.2",
        "status": "ACTIVE",
        "sensitivity": 0.85
      }
    ],
    "approval_rules": {
      "auto_approval_threshold": 0.3,
      "auto_rejection_threshold": 0.8,
      "max_auto_approval_amount": 50000,
      "required_human_review_conditions": [
        "ç”³è¯·é‡‘é¢è¶…è¿‡5ä¸‡å…ƒ",
        "ä¿¡ç”¨è¯„åˆ†ä½äº700åˆ†",
        "å­˜åœ¨æ½œåœ¨æ¬ºè¯ˆé£é™©"
      ]
    },
    "business_parameters": {
      "max_debt_to_income_ratio": 0.5,
      "min_credit_score": 600,
      "max_loan_amount_by_category": {
        "ç§æ¤è´·": 50000,
        "è®¾å¤‡è´·": 200000,
        "å…¶ä»–": 30000
      }
    }
  }
}
```

### 9.5 æŸ¥è¯¢å¤–éƒ¨æ•°æ® (ä¾›Difyè°ƒç”¨)

- **URL**: `/api/v1/ai-agent/external-data/{user_id}`
- **Method**: `GET`
- **è®¤è¯**: Required (AI Agent Token)
- **ç”¨é€”**: Difyå·¥ä½œæµè°ƒç”¨æ­¤æ¥å£è·å–ç”¨æˆ·çš„å¤–éƒ¨å¾ä¿¡ã€é“¶è¡Œæµæ°´ç­‰ä¿¡æ¯
- **Query Parameters**:
  - `data_types` (string): éœ€è¦æŸ¥è¯¢çš„æ•°æ®ç±»å‹ï¼Œç”¨é€—å·åˆ†éš”ï¼Œå¦‚ "credit,bank_flow,blacklist"
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "Success",
  "data": {
    "user_id": "user_uuid_123",
    "credit_report": {
      "score": 750,
      "grade": "ä¼˜ç§€",
      "report_date": "2024-03-01",
      "loan_history": [],
      "overdue_records": 0
    },
    "bank_flow": {
      "average_monthly_income": 6500,
      "account_stability": "ç¨³å®š",
      "last_6_months_flow": [
        {"month": "2024-02", "income": 7200, "expense": 4800},
        {"month": "2024-01", "income": 6800, "expense": 5100}
      ]
    },
    "blacklist_check": {
      "is_blacklisted": false,
      "check_time": "2024-03-10T10:05:00Z"
    },
    "government_subsidy": {
      "received_subsidies": [
        {"year": 2023, "type": "ç§ç²®è¡¥è´´", "amount": 1200},
        {"year": 2022, "type": "å†œæœºè´­ç½®è¡¥è´´", "amount": 3000}
      ]
    }
  }
}
```

### 9.6 æ›´æ–°ç”³è¯·çŠ¶æ€ (ä¾›ç³»ç»Ÿå†…éƒ¨è°ƒç”¨)

- **URL**: `/api/v1/ai-agent/applications/{application_id}/status`
- **Method**: `PUT`
- **è®¤è¯**: Required (System Token)
- **ç”¨é€”**: ç³»ç»Ÿå†…éƒ¨æ›´æ–°ç”³è¯·çŠ¶æ€ï¼Œè®°å½•å®¡æ‰¹æµç¨‹çš„å„ä¸ªé˜¶æ®µ
- **Request Body**:
```json
{
  "status": "AI_REVIEWING",
  "operator": "AI_SYSTEM",
  "remarks": "AIæ™ºèƒ½ä½“æ­£åœ¨åˆ†æç”³è¯·ä¿¡æ¯",
  "metadata": {
    "workflow_execution_id": "dify_exec_uuid_456",
    "stage": "RISK_ASSESSMENT",
    "progress": 60
  }
}
```
- **Response (200 OK)**:
```json
{
  "code": 0,
  "message": "ç”³è¯·çŠ¶æ€æ›´æ–°æˆåŠŸ",
  "data": null
}
```

## 10. AIæ™ºèƒ½ä½“è®¤è¯è¯´æ˜

### 10.1 AI Agent Token

AIæ™ºèƒ½ä½“ä½¿ç”¨ä¸“ç”¨çš„Tokenè¿›è¡Œè®¤è¯ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **Tokenç±»å‹**: `AI-Agent-Token`
- **Headeræ ¼å¼**: `Authorization: AI-Agent-Token <token>`
- **æœ‰æ•ˆæœŸ**: é•¿æœŸæœ‰æ•ˆï¼ˆå¯é…ç½®åˆ·æ–°ç­–ç•¥ï¼‰
- **æƒé™èŒƒå›´**: ä»…é™æ™ºèƒ½ä½“ç›¸å…³æ¥å£
- **å®‰å…¨æªæ–½**: IPç™½åå•é™åˆ¶ã€è¯·æ±‚é¢‘ç‡é™åˆ¶

### 10.2 Tokenè·å–æ–¹å¼

```bash
# ç¤ºä¾‹ï¼šé€šè¿‡ç³»ç»Ÿé…ç½®æˆ–ç¯å¢ƒå˜é‡è·å–
AI_AGENT_TOKEN="ai_agent_secure_token_123456"
```

### 10.3 å·¥ä½œæµè®¤è¯ç¤ºä¾‹

```bash
# Difyå·¥ä½œæµè°ƒç”¨ç¤ºä¾‹
curl -X GET "http://localhost:8080/api/v1/ai-agent/applications/loan_app_uuid_789/info" \
  -H "Authorization: AI-Agent-Token ai_agent_secure_token_123456" \
  -H "Content-Type: application/json"
```

## 11. é”™è¯¯ç æ‰©å±•

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | è¯´æ˜ |
|--------|------------|------|
| 9001   | 400        | AIåˆ†æå‚æ•°é”™è¯¯ |
| 9002   | 401        | AI Agent Tokenæ— æ•ˆ |
| 9003   | 403        | AI Agentæƒé™ä¸è¶³ |
| 9004   | 404        | ç”³è¯·ä¿¡æ¯ä¸å­˜åœ¨ |
| 9005   | 409        | ç”³è¯·çŠ¶æ€å†²çªï¼Œæ— æ³•å¤„ç† |
| 9006   | 500        | AIæ¨¡å‹è°ƒç”¨å¤±è´¥ |
| 9007   | 503        | AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ |

# AIæ™ºèƒ½ä½“æ¥å£

## æ¦‚è¿°

æœ¬ç³»ç»Ÿçš„AIæ™ºèƒ½ä½“æ¥å£æ”¯æŒ**ç»Ÿä¸€çš„å¤šç±»å‹å®¡æ‰¹å·¥ä½œæµ**ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å¹¶å¤„ç†ä¸åŒç±»å‹çš„ç”³è¯·ï¼š
- **è´·æ¬¾ç”³è¯·**ï¼šä¼ ç»Ÿçš„é‡‘èè´·æ¬¾å®¡æ‰¹
- **å†œæœºç§Ÿèµç”³è¯·**ï¼šå†œä¸šæœºæ¢°è®¾å¤‡ç§Ÿèµå®¡æ‰¹

é€šè¿‡ç»Ÿä¸€çš„æ¥å£è®¾è®¡ï¼ŒDifyå·¥ä½œæµå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¥å£å¤„ç†ä¸åŒç±»å‹çš„ç”³è¯·ï¼Œç³»ç»Ÿä¼šæ ¹æ®ç”³è¯·IDè‡ªåŠ¨è¯†åˆ«ç±»å‹å¹¶è°ƒç”¨ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **ç»Ÿä¸€æ¥å£è®¾è®¡**ï¼šä¸€å¥—æ¥å£å¤„ç†å¤šç§ç”³è¯·ç±»å‹
- ğŸ¤– **æ™ºèƒ½ç±»å‹è¯†åˆ«**ï¼šæ ¹æ®ç”³è¯·IDå‰ç¼€è‡ªåŠ¨åˆ¤æ–­ç”³è¯·ç±»å‹
- ğŸ“Š **å®Œæ•´æ—¥å¿—è®°å½•**ï¼šæ‰€æœ‰AIæ“ä½œéƒ½æœ‰è¯¦ç»†çš„å®¡è®¡æ—¥å¿—
- ğŸ”’ **æ•°æ®è„±æ•ä¿æŠ¤**ï¼šè‡ªåŠ¨è„±æ•æ•æ„Ÿä¿¡æ¯ï¼ˆå§“åã€èº«ä»½è¯ã€æ‰‹æœºå·ï¼‰
- âš¡ **é«˜æ€§èƒ½å¤„ç†**ï¼šæ”¯æŒå¹¶å‘å¤„ç†å¤šä¸ªå®¡æ‰¹è¯·æ±‚
- ğŸ¯ **å†³ç­–å¯è¿½æº¯**ï¼šæ¯ä¸ªAIå†³ç­–éƒ½æœ‰å®Œæ•´çš„åˆ†æé“¾è·¯

## ç”³è¯·IDæ ¼å¼è§„èŒƒ

| ç”³è¯·ç±»å‹ | IDå‰ç¼€ | ç¤ºä¾‹ | è¯´æ˜ |
|---------|--------|------|------|
| è´·æ¬¾ç”³è¯· | `app_`, `test_app_`, `loan_` | `test_app_001` | ä¼ ç»Ÿæ ¼å¼æˆ–ä»¥app_å¼€å¤´ |
| å†œæœºç§Ÿèµ | `ml_`, `leasing_` | `ml_test_001` | ä»¥ml_æˆ–leasing_å¼€å¤´ |

### è·å–ç”³è¯·ä¿¡æ¯ï¼ˆç»Ÿä¸€æ¥å£ï¼‰

**æ¥å£è¯´æ˜**ï¼šDifyå·¥ä½œæµè°ƒç”¨æ­¤æ¥å£è·å–ç”³è¯·çš„è¯¦ç»†ä¿¡æ¯ï¼Œè‡ªåŠ¨è¯†åˆ«è´·æ¬¾ç”³è¯·æˆ–å†œæœºç§Ÿèµç”³è¯·ç±»å‹

- **URL**: `/ai-agent/applications/{application_id}/info`
- **Method**: `GET`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯
- **Parameters**:
  - `application_id` (path): ç”³è¯·IDï¼Œæ”¯æŒè´·æ¬¾ç”³è¯·IDå’Œå†œæœºç§Ÿèµç”³è¯·ID

**å“åº”ç¤ºä¾‹ï¼ˆè´·æ¬¾ç”³è¯·ï¼‰**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "application_type": "LOAN_APPLICATION",
    "application_id": "test_app_001",
    "product_info": {
      "product_id": "product_001",
      "name": "å†œä¸šç§æ¤è´·",
      "category": "å†œä¸šè´·æ¬¾",
      "max_amount": 500000,
      "interest_rate_yearly": "4.5%"
    },
    "application_info": {
      "amount": 100000,
      "term_months": 24,
      "purpose": "è´­ä¹°å†œä¸šè®¾å¤‡",
      "submitted_at": "2024-05-29T10:00:00Z",
      "status": "PENDING_AI_REVIEW"
    },
    "applicant_info": {
      "user_id": "user_001",
      "real_name": "å¼ **",
      "id_card_number": "320***********1234",
      "phone": "138****0001",
      "address": "æ±Ÿè‹çœå—äº¬å¸‚ç„æ­¦åŒºå†œä¸šç¤ºèŒƒå›­",
      "age": 35,
      "is_verified": true
    },
    "financial_info": {
      "annual_income": 200000,
      "existing_loans": 0,
      "credit_score": 750,
      "account_balance": 50000,
      "land_area": "10äº©",
      "farming_experience": "8å¹´"
    },
    "uploaded_documents": [
      {
        "doc_type": "èº«ä»½è¯",
        "file_id": "file_001",
        "file_url": "/api/files/file_001",
        "ocr_result": {},
        "extracted_info": {}
      }
    ],
    "external_data": {
      "credit_bureau_score": 750,
      "blacklist_check": false,
      "previous_loan_history": [],
      "land_ownership_verified": true
    }
  }
}
```

**å“åº”ç¤ºä¾‹ï¼ˆå†œæœºç§Ÿèµç”³è¯·ï¼‰**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "application_type": "MACHINERY_LEASING",
    "application_id": "ml_test_001",
    "lessee_info": {
      "user_id": "lessee_001",
      "real_name": "é™ˆ**",
      "id_card_number": "320***********1234",
      "phone": "138****2001",
      "address": "æ±Ÿè‹çœå—äº¬å¸‚ç„æ­¦åŒºå†œä¸šåˆä½œç¤¾è·¯28å·",
      "occupation": "ç§æ¤å¤§æˆ·",
      "annual_income": 180000,
      "farming_experience": "8å¹´",
      "credit_rating": "è‰¯å¥½",
      "is_verified": true,
      "previous_leasing_count": 3
    },
    "lessor_info": {
      "user_id": "lessor_001",
      "real_name": "å†œ**åˆä½œç¤¾",
      "phone": "025****1001",
      "business_name": "æ±Ÿè‹å†œæœºæœåŠ¡åˆä½œç¤¾",
      "business_license": "91320***********",
      "verification_status": "å·²è®¤è¯",
      "credit_rating": "AAA",
      "established_date": "2018-03-15",
      "average_rating": 4.8,
      "successful_leasing_count": 156,
      "total_machinery_count": 12
    },
    "machinery_info": {
      "machinery_id": "machinery_001",
      "type": "æ‹–æ‹‰æœº",
      "brand_model": "çº¦ç¿°è¿ªå°”6B-1404",
      "engine_power": "140é©¬åŠ›",
      "manufacturing_year": 2022,
      "condition": "ä¼˜ç§€",
      "daily_rent": 500,
      "deposit": 2000,
      "location": "æ±Ÿè‹çœå—äº¬å¸‚å…­åˆåŒº",
      "availability": true,
      "last_maintenance": "2024-05-01",
      "insurance_status": "å·²æŠ•ä¿",
      "insurance_expiry": "2025-03-15"
    },
    "leasing_details": {
      "requested_start_date": "2024-06-01",
      "requested_end_date": "2024-06-10",
      "rental_days": 10,
      "total_amount": 5000,
      "deposit_amount": 2000,
      "usage_purpose": "ç‰ç±³ç§æ¤",
      "work_location": "æ±Ÿè‹çœå—äº¬å¸‚å…­åˆåŒºé©¬éè¡—é“",
      "estimated_work_area": "50äº©",
      "special_requirements": "éœ€è¦é…å¥—æ’­ç§æœº"
    },
    "risk_assessment": {
      "lessee_credit_score": 720,
      "lessor_reliability": "é«˜",
      "machinery_condition": "ä¼˜ç§€",
      "insurance_status": "å·²æŠ•ä¿",
      "seasonal_risk": "ä½",
      "weather_forecast": "é€‚å®œä½œä¸š",
      "regional_activity": "æ­£å¸¸"
    }
  }
}
```

### æäº¤AIå†³ç­–ï¼ˆç»Ÿä¸€æ¥å£ï¼‰

**æ¥å£è¯´æ˜**ï¼šDifyå·¥ä½œæµå®ŒæˆAIåˆ†æåï¼Œè°ƒç”¨æ­¤æ¥å£æäº¤å†³ç­–ç»“æœï¼Œæ”¯æŒå¤šç§ç”³è¯·ç±»å‹çš„ç»Ÿä¸€å¤„ç†

- **URL**: `/ai-agent/applications/{application_id}/decisions`
- **Method**: `POST`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯
- **Parameters**:
  - `application_id` (path): ç”³è¯·ID

**è¯·æ±‚å‚æ•°ï¼ˆè´·æ¬¾ç”³è¯·ï¼‰**ï¼š
```json
{
  "application_type": "LOAN_APPLICATION",
  "ai_analysis": {
    "risk_level": "LOW",
    "risk_score": 0.25,
    "confidence_score": 0.85,
    "analysis_summary": "ç”³è¯·äººä¿¡ç”¨çŠ¶å†µè‰¯å¥½ï¼Œæ”¶å…¥ç¨³å®šï¼Œé£é™©è¾ƒä½",
    "detailed_analysis": {
      "credit_analysis": "ä¿¡ç”¨åˆ†æ•°750ï¼Œæ— ä¸è‰¯è®°å½•",
      "financial_analysis": "å¹´æ”¶å…¥20ä¸‡ï¼Œå€ºåŠ¡æ”¶å…¥æ¯”0%",
      "agricultural_analysis": "å…·å¤‡8å¹´å†œä¸šç»éªŒï¼ŒåœŸåœ°èµ„æºå……è¶³",
      "risk_factors": ["å­£èŠ‚æ€§æ”¶å…¥æ³¢åŠ¨"],
      "strengths": ["ä¿¡ç”¨è¯„åˆ†é«˜", "æ— ç°æœ‰è´·æ¬¾", "å†œä¸šç»éªŒä¸°å¯Œ"]
    },
    "recommendations": ["å»ºè®®ç›‘æ§å­£èŠ‚æ€§é£é™©", "å…³æ³¨å†œä¸šå¸‚åœºå˜åŒ–"]
  },
  "ai_decision": {
    "decision": "AUTO_APPROVED",
    "approved_amount": 100000,
    "approved_term_months": 24,
    "suggested_interest_rate": "4.5%",
    "conditions": ["å®šæœŸè¿˜æ¬¾", "ä¿æŒè‰¯å¥½ä¿¡ç”¨"],
    "next_action": "ç”Ÿæˆè´·æ¬¾åˆåŒ"
  },
  "processing_info": {
    "ai_model_version": "LLM-v4.0-unified",
    "processing_time_ms": 2500,
    "workflow_id": "dify-unified-structured-output",
    "processed_at": "2024-05-29T10:05:00Z"
  }
}
```

**è¯·æ±‚å‚æ•°ï¼ˆå†œæœºç§Ÿèµç”³è¯·ï¼‰**ï¼š
```json
{
  "application_type": "MACHINERY_LEASING",
  "ai_analysis": {
    "risk_level": "LOW",
    "risk_score": 0.3,
    "confidence_score": 0.8,
    "analysis_summary": "æ‰¿ç§Ÿæ–¹ä¿¡ç”¨è‰¯å¥½ï¼Œå‡ºç§Ÿæ–¹èµ„è´¨ä¼˜ç§€ï¼Œè®¾å¤‡çŠ¶å†µè‰¯å¥½",
    "detailed_analysis": {
      "lessee_analysis": "å†œä¸šç»éªŒä¸°å¯Œï¼Œå†å²ç§Ÿèµè®°å½•è‰¯å¥½",
      "lessor_analysis": "èµ„è´¨è®¤è¯å®Œæ•´ï¼ŒæœåŠ¡è¯„ä»·ä¼˜ç§€",
      "equipment_analysis": "è®¾å¤‡çŠ¶å†µä¼˜ç§€ï¼Œä¿é™©é½å…¨",
      "risk_factors": ["å¤©æ°”å˜åŒ–é£é™©"],
      "strengths": ["åŒæ–¹ä¿¡ç”¨è‰¯å¥½", "è®¾å¤‡çŠ¶å†µä¼˜ç§€", "ä¿é™©è¦†ç›–å®Œæ•´"]
    },
    "recommendations": ["å…³æ³¨å¤©æ°”é¢„æŠ¥", "ç¡®ä¿è®¾å¤‡æ“ä½œåŸ¹è®­"]
  },
  "ai_decision": {
    "decision": "AUTO_APPROVE",
    "suggested_deposit": 2000,
    "approved_rental_terms": {
      "daily_rate": 500,
      "rental_period": "2024-06-01è‡³2024-06-10"
    },
    "conditions": ["æä¾›æ“ä½œè¯æ˜", "è´­ä¹°æ„å¤–ä¿é™©"],
    "next_action": "ç”Ÿæˆç§ŸèµåˆåŒ"
  },
  "processing_info": {
    "ai_model_version": "LLM-v4.0-unified",
    "processing_time_ms": 2200,
    "workflow_id": "dify-unified-structured-output",
    "processed_at": "2024-05-29T10:05:00Z"
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "AIå†³ç­–æäº¤æˆåŠŸ",
  "data": {
    "application_id": "test_app_001",
    "application_type": "LOAN_APPLICATION",
    "old_status": "PENDING_AI_REVIEW",
    "new_status": "AUTO_APPROVED",
    "decision_id": "decision_001",
    "processed_at": "2024-05-29T10:05:00Z",
    "ai_operation_id": "ai_op_001"
  }
}
```

### è·å–å¤–éƒ¨æ•°æ®ï¼ˆå¤šç±»å‹æ”¯æŒï¼‰

**æ¥å£è¯´æ˜**ï¼šè·å–ç”¨æˆ·çš„å¤–éƒ¨æ•°æ®ï¼Œæ”¯æŒä¸åŒç”³è¯·ç±»å‹æ‰€éœ€çš„æ•°æ®

- **URL**: `/ai-agent/external-data/{user_id}`
- **Method**: `GET`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯
- **Parameters**:
  - `user_id` (path): ç”¨æˆ·ID
  - `data_types` (query): æ•°æ®ç±»å‹åˆ—è¡¨ï¼Œé€—å·åˆ†éš”

**æ”¯æŒçš„æ•°æ®ç±»å‹**ï¼š
- `credit_report`: å¾ä¿¡æŠ¥å‘Š
- `bank_flow`: é“¶è¡Œæµæ°´
- `blacklist_check`: é»‘åå•æ£€æŸ¥
- `government_subsidy`: æ”¿åºœè¡¥è´´
- `farming_qualification`: å†œä¸šèµ„è´¨ï¼ˆå†œæœºç§Ÿèµä¸“ç”¨ï¼‰

### è·å–AIæ¨¡å‹é…ç½®ï¼ˆå¤šç±»å‹æ”¯æŒï¼‰

**æ¥å£è¯´æ˜**ï¼šè·å–AIæ¨¡å‹çš„é…ç½®ä¿¡æ¯ï¼Œæ”¯æŒå¤šç§ç”³è¯·ç±»å‹çš„ä¸šåŠ¡è§„åˆ™

- **URL**: `/ai-agent/config/models`
- **Method**: `GET`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "loan_approval": {
      "auto_approval_threshold": 0.3,
      "auto_rejection_threshold": 0.7,
      "max_auto_approval_amount": 500000,
      "required_human_review_conditions": [
        "ç”³è¯·é‡‘é¢è¶…è¿‡50ä¸‡",
        "ä¿¡ç”¨åˆ†æ•°ä½äº600",
        "å­˜åœ¨é»‘åå•è®°å½•"
      ]
    },
    "machinery_leasing": {
      "auto_approval_threshold": 0.4,
      "auto_rejection_threshold": 0.7,
      "max_auto_approval_deposit": 10000,
      "required_human_review_conditions": [
        "æŠ¼é‡‘è¶…è¿‡1ä¸‡",
        "è®¾å¤‡ä»·å€¼è¶…è¿‡50ä¸‡",
        "æ‰¿ç§Ÿæ–¹ä¿¡ç”¨è¯„çº§ä½äºè‰¯å¥½"
      ]
    },
    "risk_assessment_models": [
      {
        "model_id": "credit_risk_v2.1",
        "model_type": "ä¿¡ç”¨é£é™©è¯„ä¼°",
        "version": "2.1",
        "status": "active"
      },
      {
        "model_id": "machinery_risk_v1.3",
        "model_type": "å†œæœºç§Ÿèµé£é™©è¯„ä¼°",
        "version": "1.3", 
        "status": "active"
      }
    ]
  }
}
```

## å†œæœºç§Ÿèµä¸“ç”¨æ¥å£

### è·å–å†œæœºç§Ÿèµç”³è¯·ä¿¡æ¯ï¼ˆä¸“ç”¨æ¥å£ï¼‰

**æ¥å£è¯´æ˜**ï¼šä¸“é—¨ç”¨äºå†œæœºç§Ÿèµç”³è¯·çš„ä¿¡æ¯è·å–ï¼Œæä¾›æ›´è¯¦ç»†çš„å†œæœºç§Ÿèµç›¸å…³æ•°æ®

- **URL**: `/ai-agent/machinery-leasing/applications/{application_id}`
- **Method**: `GET`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯
- **Parameters**:
  - `application_id` (path): å†œæœºç§Ÿèµç”³è¯·ID

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "application_id": "ml_test_001",
    "lessee_info": {
      "user_id": "lessee_001",
      "real_name": "é™ˆ**",
      "id_card_number": "320***********1234",
      "phone": "138****2001",
      "address": "æ±Ÿè‹çœå—äº¬å¸‚ç„æ­¦åŒºå†œä¸šåˆä½œç¤¾è·¯28å·",
      "occupation": "ç§æ¤å¤§æˆ·",
      "annual_income": 180000,
      "farming_experience": "8å¹´",
      "credit_rating": "è‰¯å¥½",
      "is_verified": true,
      "previous_leasing_count": 3
    },
    "lessor_info": {
      "user_id": "lessor_001",
      "real_name": "å†œ**åˆä½œç¤¾",
      "phone": "025****1001",
      "business_name": "æ±Ÿè‹å†œæœºæœåŠ¡åˆä½œç¤¾",
      "verification_status": "å·²è®¤è¯",
      "credit_rating": "AAA",
      "average_rating": 4.8,
      "successful_leasing_count": 156
    },
    "machinery_info": {
      "machinery_id": "machinery_001",
      "type": "æ‹–æ‹‰æœº",
      "brand_model": "çº¦ç¿°è¿ªå°”6B-1404",
      "daily_rent": 500,
      "deposit": 2000,
      "location": "æ±Ÿè‹çœå—äº¬å¸‚å…­åˆåŒº"
    },
    "leasing_details": {
      "requested_start_date": "2024-06-01",
      "requested_end_date": "2024-06-10",
      "rental_days": 10,
      "total_amount": 5000,
      "deposit_amount": 2000,
      "usage_purpose": "ç‰ç±³ç§æ¤"
    },
    "risk_assessment": {
      "lessee_credit_score": 720,
      "lessor_reliability": "é«˜",
      "machinery_condition": "ä¼˜ç§€",
      "insurance_status": "å·²æŠ•ä¿"
    }
  }
}
```

### æäº¤å†œæœºç§ŸèµAIå†³ç­–ï¼ˆä¸“ç”¨æ¥å£ï¼‰

**æ¥å£è¯´æ˜**ï¼šä¸“é—¨ç”¨äºå†œæœºç§Ÿèµçš„AIå†³ç­–æäº¤

- **URL**: `/ai-agent/machinery-leasing/applications/{application_id}/decisions`
- **Method**: `POST`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯

## AIæ“ä½œæ—¥å¿—æ¥å£

### è·å–AIæ“ä½œæ—¥å¿—

**æ¥å£è¯´æ˜**ï¼šæŸ¥è¯¢AIæ“ä½œçš„è¯¦ç»†æ—¥å¿—ï¼Œæ”¯æŒå¤šç§ç”³è¯·ç±»å‹

- **URL**: `/ai-agent/logs`
- **Method**: `GET`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯
- **Parameters**:
  - `application_id` (query, optional): ç”³è¯·ID
  - `application_type` (query, optional): ç”³è¯·ç±»å‹ (LOAN_APPLICATION/MACHINERY_LEASING)
  - `page` (query, optional): é¡µç ï¼Œé»˜è®¤1
  - `limit` (query, optional): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "logs": [
      {
        "id": "ai_op_001",
        "application_id": "test_app_001",
        "application_type": "LOAN_APPLICATION",
        "operation_type": "DECISION_SUBMISSION",
        "ai_model_version": "LLM-v4.0-unified",
        "decision": "AUTO_APPROVED",
        "risk_score": 0.25,
        "confidence_score": 0.85,
        "processing_time_ms": 2500,
        "workflow_id": "dify-unified-structured-output",
        "created_at": "2024-05-29T10:05:00Z"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 1,
      "total_count": 1,
      "limit": 20
    }
  }
}
```

## AIæ¨¡å‹é…ç½®æ¥å£

### æ›´æ–°AIæ¨¡å‹é…ç½®

**æ¥å£è¯´æ˜**ï¼šæ›´æ–°AIæ¨¡å‹çš„ä¸šåŠ¡é…ç½®ï¼Œæ”¯æŒå¤šç§ç”³è¯·ç±»å‹

- **URL**: `/ai-agent/config/models`
- **Method**: `PUT`
- **Headers**: éœ€è¦AI Agent Tokenè®¤è¯

## é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | å¤„ç†å»ºè®® |
|-------|------|---------|
| 0 | æˆåŠŸ | - |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼ |
| 401 | AI Agent Tokenæ— æ•ˆ | æ£€æŸ¥Tokené…ç½® |
| 404 | ç”³è¯·ä¸å­˜åœ¨ | ç¡®è®¤ç”³è¯·IDæ­£ç¡® |
| 422 | ç”³è¯·çŠ¶æ€ä¸å…è®¸AIå¤„ç† | æ£€æŸ¥ç”³è¯·å½“å‰çŠ¶æ€ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»æŠ€æœ¯æ”¯æŒ |

## è®¤è¯è¯´æ˜

æ‰€æœ‰AIæ™ºèƒ½ä½“æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«AI Agent Tokenï¼š

```http
Authorization: AI-Agent-Token your_token_here
```

Tokené…ç½®ä½ç½®ï¼š
- ç¯å¢ƒå˜é‡ï¼š`AI_AGENT_TOKEN`
- é…ç½®æ–‡ä»¶ï¼š`configs/config.yaml`

## æ•°æ®è„±æ•è¯´æ˜

ä¸ºä¿æŠ¤ç”¨æˆ·éšç§ï¼ŒAPIå“åº”ä¸­çš„æ•æ„Ÿä¿¡æ¯ä¼šè‡ªåŠ¨è„±æ•ï¼š

| å­—æ®µç±»å‹ | è„±æ•è§„åˆ™ | ç¤ºä¾‹ |
|---------|---------|------|
| å§“å | ä¿ç•™å§“ï¼Œå…¶ä»–ç”¨*ä»£æ›¿ | å¼ ä¸‰ â†’ å¼ * |
| èº«ä»½è¯å· | ä¿ç•™å‰3ä½å’Œå4ä½ | 320123199001011234 â†’ 320***********1234 |
| æ‰‹æœºå· | ä¿ç•™å‰3ä½å’Œå4ä½ | 13812345678 â†’ 138****5678 |

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|-------|------|
| å“åº”æ—¶é—´ | < 500ms | è·å–ç”³è¯·ä¿¡æ¯æ¥å£ |
| å“åº”æ—¶é—´ | < 1000ms | æäº¤AIå†³ç­–æ¥å£ |
| å¹¶å‘æ”¯æŒ | 100+ QPS | é«˜å³°æœŸå¤„ç†èƒ½åŠ› |
| å¯ç”¨æ€§ | 99.9% | æœåŠ¡å¯ç”¨æ€§ç›®æ ‡ |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv4.0-ç»Ÿä¸€å¤šç±»å‹ç‰ˆ  
**æœ€åæ›´æ–°**ï¼š2024å¹´5æœˆ29æ—¥  
**é€‚ç”¨èŒƒå›´**ï¼šæ…§å†œé‡‘èåç«¯API v1.0+ 